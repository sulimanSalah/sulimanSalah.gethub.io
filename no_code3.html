<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ£ØµØ­Ø§Ø¨ Ø§Ù„Ø¹Ù…Ù„ - Ø´ØºÙ„Ù†ÙŠ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --light: #f9fafb;
            --dark: #1f2937;
            --gray: #6b7280;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f5f7fa;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡ Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ¸Ù */
        .employer-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .employer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .skill-tag {
            display: inline-flex;
            align-items: center;
            background-color: #eef2ff;
            color: #4338ca;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            margin: 0.125rem;
        }

        .status-verified {
            background-color: #d1fae5;
            color: #065f46;
        }
        .status-unverified {
            background-color: #fef3c7;
            color: #92400e;
        }
        .error-message {
            background-color: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            border-radius: 8px;
        }
    </style>
</head>
<body class="min-h-screen p-8">
    
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4 rtl:space-x-reverse">
                    <div class="text-2xl font-bold text-blue-600">Ø´ØºÙ„Ù†ÙŠ</div>
                </div>
                <div class="hidden md:flex items-center space-x-8 rtl:space-x-reverse">
                    <a href="index.html" class="text-gray-700 hover:text-blue-600 font-medium transition-colors">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                    <a href="#" class="text-gray-700 hover:text-blue-600 font-medium transition-colors">Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</a>
                    <a href="#" class="text-blue-600 font-bold">Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±ÙƒØ§Øª</a>
                    <a href="signup.html" class="text-gray-700 hover:text-blue-600 font-medium transition-colors">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨</a>
                </div>
                </div>
        </div>
    </nav>
    
    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-4 md:mb-0">Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ£ØµØ­Ø§Ø¨ Ø§Ù„Ø¹Ù…Ù„</h1>
            <div class="relative w-full md:w-1/3">
                <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø´Ø±ÙƒØ©..."
                       class="w-full pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-right">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                    <i class="fas fa-search text-gray-400"></i>
                </div>
            </div>
        </div>

        <div class="flex flex-col md:flex-row md:space-x-4 rtl:space-x-reverse mb-6">
            <div class="w-full md:w-1/2 mb-4 md:mb-0">
                <label for="stateFilter" class="block text-sm font-medium text-gray-700">ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:</label>
                <select id="stateFilter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª</option>
                    </select>
            </div>
            <div class="w-full md:w-1/2">
                <label for="cityFilter" class="block text-sm font-medium text-gray-700">ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>
                <select id="cityFilter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md" disabled>
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ù†</option>
                </select>
            </div>
        </div>

        <div id="employersList" class="space-y-4">
            <div id="loadingIndicator" class="text-center text-lg text-gray-500 p-8">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Øª... <i class="fas fa-spinner fa-spin mr-2"></i></div>
            <div id="noEmployersFound" class="hidden text-center text-lg text-gray-500 p-8">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø´Ø±ÙƒØ§Øª.</div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        
        // ğŸš¨ Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù…ÙˆØ­Ø¯ ÙˆØ§Ù„Ù€ API Ø§Ù„Ø°ÙŠ ØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù†Ù‡ 
        const firebaseConfig = {
          apiKey: "AIzaSyBsIaCjE7QOQ6QkhqhCIMA3sLdMvxBxPHk",
          authDomain: "shaglni-c64c0.firebaseapp.com",
          projectId: "shaglni-c64c0",
          storageBucket: "shaglni-c64c0.firebasestorage.app", 
          messagingSenderId: "768887356636",
          appId: "1:768887356636:web:fe1a49e39f9dc2889c8819",
          measurementId: "G-TVXYPC75BL" 
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const employersList = document.getElementById('employersList');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const noEmployersFound = document.getElementById('noEmployersFound');
        const searchInput = document.getElementById('searchInput');
        const stateFilter = document.getElementById('stateFilter');
        const cityFilter = document.getElementById('cityFilter');
        
        let allEmployers = [];

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ (Ù„Ù„ØªØµÙÙŠØ© - ØªÙ… Ù†Ø³Ø®Ù‡Ø§ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ)
        const sudanLocations = {
            "Ø§Ù„Ø®Ø±Ø·ÙˆÙ…": {
                "Ø§Ù„Ø®Ø±Ø·ÙˆÙ…": ["Ø§Ù„Ø³Ø¬Ø§Ù†Ø©", "Ø§Ù„Ø¹Ù…Ø§Ø±Ø§Øª", "Ø§Ù„Ø±ÙŠØ§Ø¶"],
                "Ø£Ù… Ø¯Ø±Ù…Ø§Ù†": ["Ø§Ù„Ø¹Ø¨Ø§Ø³ÙŠØ©", "Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„", "Ø§Ù„Ù…ÙˆØ±Ø¯Ø©"],
                "Ø§Ù„Ø®Ø±Ø·ÙˆÙ… Ø¨Ø­Ø±ÙŠ": ["ÙƒØ§ÙÙˆØ±ÙŠ", "Ø´Ù…Ø¨Ø§Øª", "Ø§Ù„Ø´Ø¹Ø¨ÙŠØ©"],
            },
            "Ø§Ù„Ø¬Ø²ÙŠØ±Ø©": ["ÙˆØ¯ Ù…Ø¯Ù†ÙŠ", "Ø§Ù„Ø­ØµØ§Ø­ÙŠØµØ§", "Ø§Ù„Ù…Ù†Ø§Ù‚Ù„"],
            "Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±": ["Ø¨ÙˆØ±ØªØ³ÙˆØ¯Ø§Ù†", "Ø³ÙˆØ§ÙƒÙ†", "Ø·ÙˆÙƒØ±"],
            "ÙƒØ³Ù„Ø§": ["ÙƒØ³Ù„Ø§", "Ø­Ù„ÙØ§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", "Ø§Ù„Ù‚Ø¶Ø§Ø±Ù"],
            // ... ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¨Ù‚ÙŠØ© Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ù‡Ù†Ø§
        };
        
        function populateStateFilter() {
            const stateNames = Object.keys(sudanLocations);
            stateNames.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = `ÙˆÙ„Ø§ÙŠØ© ${state}`;
                stateFilter.appendChild(option);
            });
        }

        async function fetchEmployers() {
            loadingIndicator.classList.remove('hidden');
            try {
                // âœ… **Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ**: ØªÙ… ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† "employers" Ø¥Ù„Ù‰ "All_jops"
                const querySnapshot = await getDocs(collection(db, "All_jops")); 
                
                allEmployers = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                // ÙØ±Ø² Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£Ø­Ø¯Ø« (Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† Ù„Ø¯ÙŠÙƒ Ø­Ù‚Ù„ 'createdAt' Ø£Ùˆ 'timestamp')
                allEmployers.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0)); 
                filterAndRenderEmployers();
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø´Ø±ÙƒØ§Øª:", error);
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ø§Ù‹
                employersList.innerHTML = `<div class="text-center text-red-500 p-8 error-message">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª: ${error.message}. ØªØ£ÙƒØ¯ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†.</div>`;
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        function renderEmployers(employers) {
            employersList.innerHTML = '';
            if (employers.length === 0) {
                noEmployersFound.classList.remove('hidden');
            } else {
                noEmployersFound.classList.add('hidden');
                employers.forEach(employer => {
                    // Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø¸Ù…Ø© Ø¯Ø§Ø®Ù„ Ø­Ù‚Ù„ companyInfo
                    const info = employer.companyInfo || {};
                    const verification = employer.verification || {};
                    
                    const companyName = info.name || 'Ø´Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©';
                    const businessType = info.businessType || 'Ù†Ø´Ø§Ø· ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    const description = info.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙƒØ©.';
                    const logoUrl = info.logoUrl || 'https://via.placeholder.com/60?text=Logo'; 
                    
                    const isVerified = verification.isVerified === true;
                    const statusClass = isVerified ? 'status-verified' : 'status-unverified';
                    const statusText = isVerified ? 'Ø´Ø±ÙƒØ© Ù…ÙˆØ«Ù‚Ø© âœ…' : 'ØºÙŠØ± Ù…ÙˆØ«Ù‚Ø© âš ï¸';

                    const companyCity = info.location?.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    const companyState = info.location?.state || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    const locationText = `${companyCity}ØŒ ${companyState}`;

                    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø§Ù„Ù€ subRole ÙƒØªØ§Øº Ø«Ø§Ù†ÙˆÙŠ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
                    const subRoleTag = employer.subRole 
                        ? `<span class="skill-tag">${employer.subRole === 'hiring' ? 'ØªÙˆØ¸ÙŠÙ Ø´ÙˆØ§ØºØ±' : 'ØµØ§Ø­Ø¨ Ø¹Ù…Ù„ ÙØ±Ø¯ÙŠ'}</span>`
                        : '';
                        
                    // Ø±Ø§Ø¨Ø· Ù„ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ø±ÙƒØ© (ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¦Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
                    const detailsUrl = `employer-profile.html?id=${employer.id}`;

                    const employerCard = document.createElement('div');
                    employerCard.className = 'bg-white rounded-xl shadow-sm employer-card overflow-hidden p-6';

                    employerCard.innerHTML = `
                        <div class="flex flex-col md:flex-row md:items-start md:justify-between">
                            <div class="flex items-start space-x-4 rtl:space-x-reverse mb-4 md:mb-0">
                                <img src="${logoUrl}" alt="${companyName} Logo" class="w-14 h-14 rounded-full object-cover">
                                <div>
                                    <h3 class="font-bold text-lg">${companyName}</h3>
                                    <p class="text-gray-600 text-sm mt-1">${businessType}</p>
                                    <div class="flex items-center text-gray-500 text-sm mt-2">
                                        <i class="fas fa-map-marker-alt ml-1"></i>
                                        <span>${locationText}</span>
                                        ${subRoleTag ? `<span class="mx-2">â€¢</span>` + subRoleTag : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col items-end">
                                <span class="px-3 py-1 rounded-full ${statusClass} text-xs font-semibold mb-2">${statusText}</span>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-gray-700 mb-4 line-clamp-3">${description}</p>
                            
                            <div class="flex flex-wrap items-center justify-end">
                                <a href="${detailsUrl}"
                                   class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                                   <i class="fas fa-info-circle ml-1"></i> Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                </a>
                            </div>
                        </div>
                    `;
                    employersList.appendChild(employerCard);
                });
            }
        }

        function filterAndRenderEmployers() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedState = stateFilter.value;
            const selectedCity = cityFilter.value;

            const filteredEmployers = allEmployers.filter(employer => {
                const info = employer.companyInfo || {};
                const companyCity = info.location?.city || '';
                const companyState = info.location?.state || '';

                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·ØŒ Ø£Ùˆ Ø§Ù„ÙˆØµÙ
                const employeeText = `${info.name || ''} ${info.businessType || ''} ${info.description || ''} ${companyState || ''} ${companyCity || ''}`.toLowerCase();
                const matchesSearch = employeeText.includes(searchTerm);

                const matchesState = selectedState === '' || (companyState === selectedState);
                const matchesCity = selectedCity === '' || (companyCity === selectedCity);

                return matchesSearch && matchesState && matchesCity;
            });

            renderEmployers(filteredEmployers);
        }
        
        // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØµÙÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø«
        searchInput.addEventListener('input', filterAndRenderEmployers);

        stateFilter.addEventListener('change', () => {
            const selectedState = stateFilter.value;
            cityFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ù†</option>';
            cityFilter.disabled = true;

            if (selectedState && sudanLocations[selectedState]) {
                const citiesOrAreas = sudanLocations[selectedState];
                let cities = [];
                if (Array.isArray(citiesOrAreas)) {
                    cities = citiesOrAreas;
                } else if (typeof citiesOrAreas === 'object') {
                    cities = Object.keys(citiesOrAreas);
                }
                
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    cityFilter.appendChild(option);
                });
                cityFilter.disabled = false;
            }
            cityFilter.value = ""; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ©
            filterAndRenderEmployers();
        });
        cityFilter.addEventListener('change', filterAndRenderEmployers);

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', () => {
            populateStateFilter();
            fetchEmployers();
        });

    </script>
</body>
</html>
